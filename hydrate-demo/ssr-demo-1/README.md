# SSR + 客户端水合演示项目

这是一个不依赖任何框架，纯手动实现的服务端渲染(SSR)和客户端水合(hydration)演示项目。通过这个项目，你可以直观地了解现代前端框架中SSR和水合的工作原理。

## 项目结构

```
ssr-demo-1/
├── App.js           # 应用组件定义（同时适用于客户端和服务端）
├── client.js        # 客户端水合脚本
├── index.html       # HTML模板文件
├── README.md        # 项目说明文档
├── server.js        # Node.js服务端渲染脚本
└── vdom.js          # 虚拟DOM工具库
```

## 文件说明

- **vdom.js**: 实现了React风格的虚拟DOM工具函数，包括`h`函数（创建虚拟DOM节点）、`renderToString`（服务端渲染HTML）、`hydrate`（客户端水合）等核心功能。

- **App.js**: 定义了App组件，使用虚拟DOM的`h`函数形式描述组件结构，包含计数器和消息展示等交互功能。

- **server.js**: Node.js服务端脚本，负责：
  - 创建HTTP服务器
  - 渲染App组件为HTML字符串
  - 将渲染结果和组件数据注入到HTML模板中
  - 提供静态文件服务

- **client.js**: 客户端水合脚本，负责：
  - 从`window`对象获取服务端传递的数据
  - 将交互功能绑定到服务端渲染的DOM上
  - 提供水合状态反馈

- **index.html**: HTML模板文件，包含：
  - 服务端渲染内容的占位符
  - 服务端数据注入的占位符
  - 客户端脚本的引入
  - 基本样式定义

## 运行方法

1. 确保你已安装Node.js

2. 打开终端，进入项目目录：
   ```bash
   cd /Users/dingwen/Desktop/hydrate-demo/ssr-demo-1
   ```

3. 启动Node.js服务器：
   ```bash
   node server.js
   ```

4. 在浏览器中访问：http://localhost:3000

5. 观察页面加载和水合过程，可以打开浏览器控制台查看详细日志

## 演示要点

1. **服务端渲染**：服务器首先生成完整的HTML内容，包括App组件的DOM结构

2. **数据传递**：服务端通过`<script>`标签将组件数据注入到客户端，存储在`window.__APP_PROPS__`对象中

3. **客户端水合**：客户端脚本接管服务端渲染的DOM，添加事件监听器，使页面具有交互性

4. **性能监控**：演示中包含水合时间统计和状态指示

5. **降级处理**：提供了模拟组件实现，确保在组件加载失败时仍能工作

## 关键概念解释

- **虚拟DOM**: 是对真实DOM的一种轻量级抽象表示，便于在服务端渲染和客户端水合时使用

- **服务端渲染(SSR)**: 在服务器端生成完整的HTML内容，减少客户端渲染时间，提高首屏加载速度

- **客户端水合(hydration)**: 客户端接管服务端渲染的DOM，保留已渲染的DOM结构，只添加事件监听器和必要的交互逻辑

- **h函数**: 用于创建虚拟DOM节点的函数，语法类似React.createElement

- **事件委托**: 在这个演示中，通过`data-event-*`属性标记事件，然后在客户端水合时绑定实际的事件处理函数

## 注意事项

1. 这个演示是为了展示SSR和水合的基本原理，实际生产环境中建议使用成熟的框架（如React、Vue、Angular等）

2. 为了简化实现，演示中使用了一些模拟手段来处理ES模块导入和组件共享

3. 打开浏览器控制台可以查看水合过程的详细日志信息

4. 页面底部会显示水合状态指示器，3秒后自动消失

5. 按`Ctrl+C`可以停止Node.js服务器